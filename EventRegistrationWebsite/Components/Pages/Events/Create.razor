@page "/events/create"
@using EventRegistrationWebsite.Models
@using Microsoft.AspNetCore.Components.Forms
@inject EventRegistrationWebsite.Data.ApplicationDbContext Db
@inject NavigationManager Navigation
@rendermode InteractiveServer

<h3>Create Event</h3>

<EditForm Model="@eventModel"
          OnValidSubmit="Save"
          FormName="CreateEventForm">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label>Title</label>
        <InputText class="form-control" @bind-Value="eventModel.Title" />
    </div>

    <div class="mb-3">
        <label>Description</label>
        <InputTextArea class="form-control" @bind-Value="eventModel.Description" />
    </div>

    <div class="mb-3">
        <label>Start Date</label>
        <InputDate class="form-control" @bind-Value="eventModel.StartDate" />
    </div>

    <div class="mb-3">
        <label>End Date</label>
        <InputDate class="form-control" @bind-Value="eventModel.EndDate" />
    </div>

    <div class="mb-3">
        <label>Status</label>
        <InputSelect class="form-control" @bind-Value="eventModel.Status">
            <option value="">-- Select Status --</option>
            <option value="Active">Active</option>
            <option value="Cancelled">Cancelled</option>
            <option value="Completed">Completed</option>
        </InputSelect>
    </div>

    <button type="submit" class="btn btn-primary">Create</button>
    <a class="btn btn-secondary" href="/events">Cancel</a>
</EditForm>

@code {
    [SupplyParameterFromForm]
    private Event eventModel { get; set; } = new();

    private async Task Save()
    {
        eventModel.LastUpdatedOn = DateTime.Now;

        Db.Events.Add(eventModel);
        await Db.SaveChangesAsync();
        Navigation.NavigateTo("/events");
    }
}
