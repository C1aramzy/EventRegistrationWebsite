@page "/events/delete/{id:int}"
@using EventRegistrationWebsite.Models
@using Microsoft.EntityFrameworkCore
@inject EventRegistrationWebsite.Data.ApplicationDbContext Db
@inject NavigationManager Navigation
@rendermode InteractiveServer
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "Admin")]


<h3>Delete Event</h3>

@if (eventItem == null)
{
    <p>Event not found.</p>
}
else
{
    <p>Are you sure you want to delete this event?</p>
    <p><strong>@eventItem.Title</strong></p>
    <button type="button" class="btn btn-danger" @onclick="ConfirmDelete"
    @oneclick:preventDefault="true">
    Delete
</button>
    <a class="btn btn-secondary" href="/events">Cancel</a>
}

@code {
    [Parameter]
    public int id { get; set; }

    private Event? eventItem;

    protected override async Task OnInitializedAsync()
    {
        eventItem = await Db.Events.FirstOrDefaultAsync(e => e.EventID == id);
    }

    private async Task ConfirmDelete()
    {
        Console.WriteLine("CONFIRM DELETE CLICKED");

        if (eventItem != null)
        {
            Console.WriteLine($"DELETING EVENT ID {eventItem.EventID}");
            Db.Events.Remove(eventItem);
            await Db.SaveChangesAsync();
            Console.WriteLine("DELETE SAVED");
        }
        else
        {
            Console.WriteLine("EVENT ITEM IS NULL");
        }

        Navigation.NavigateTo("/events");
    }

}
