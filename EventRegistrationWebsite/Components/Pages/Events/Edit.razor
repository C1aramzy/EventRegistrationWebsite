@page "/events/edit/{id:int}"
@using EventRegistrationWebsite.Models
@inject EventRegistrationWebsite.Data.ApplicationDbContext Db
@inject NavigationManager Navigation
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "Admin")]

<h3>Edit Event</h3>

@if (eventModel == null)
{
    <p>Event not found.</p>
}
else
{
    <EditForm Model="@eventModel" OnValidSubmit="Update" FormName="EditEventForm">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="mb-3">
            <label>Title</label>
            <InputText class="form-control" @bind-Value="eventModel.Title" />
        </div>

        <div class="mb-3">
            <label>Description</label>
            <InputTextArea class="form-control" @bind-Value="eventModel.Description" />
        </div>

        <div class="mb-3">
            <label>Start Date</label>
            <InputDate class="form-control" @bind-Value="eventModel.StartDate" />
        </div>

        <div class="mb-3">
            <label>End Date</label>
            <InputDate class="form-control" @bind-Value="eventModel.EndDate" />
        </div>

        <div class="mb-3">
            <label>Status</label>
            <InputText class="form-control" @bind-Value="eventModel.Status" />
        </div>

        <button class="btn btn-primary">Save</button>
        <a class="btn btn-secondary" href="/events">Cancel</a>
    </EditForm>
}

@code {
    [Parameter]
    public int id { get; set; }

    private Event? eventModel;

    protected override async Task OnInitializedAsync()
    {
        eventModel = await Db.Events.FirstOrDefaultAsync(e => e.EventID == id);
    }

    private async Task Update()
    {
        if (eventModel == null)
        {
            return;
        }
        eventModel.LastUpdatedOn = DateTime.Now;

        await Db.SaveChangesAsync();
        Navigation.NavigateTo("/events");
    }
}

