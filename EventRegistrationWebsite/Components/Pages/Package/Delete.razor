@page "/packages/delete/{id:int}"
@using EventRegistrationWebsite.Models
@using Microsoft.EntityFrameworkCore
@inject EventRegistrationWebsite.Data.ApplicationDbContext Db
@inject NavigationManager Navigation
@rendermode InteractiveServer
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "Admin")]

<h3>Delete Package</h3>

@if (packageItem == null)
{
    <p>Package not found.</p>
}
else
{
    <p>Are you sure you want to delete this package?</p>

    <p>
        <strong>@packageItem.PackageName</strong><br />
        Price: @packageItem.Price.ToString("0.00")
    </p>

    <button class="btn btn-danger" @onclick="ConfirmDelete">Delete</button>
    <a class="btn btn-secondary" href="/packages">Cancel</a>
}

@code{
    [Parameter]
    public int id { get; set; }

    private Package? packageItem;

    protected override async Task OnInitializedAsync()
    {
        packageItem = await Db.Packages.FirstOrDefaultAsync(p => p.PackageId == id);
    }

    private async Task ConfirmDelete()
    {
        if (packageItem != null)
        {
            Db.Packages.Remove(packageItem);
            await Db.SaveChangesAsync();
        }
        Navigation.NavigateTo("/packages");
    }
}